# 项目克隆过大的问题

## 问题原因

仓库克隆较大的主要原因是 **Git 历史记录中包含了大型文件**：

1. **`.electron-cache` 目录** - Electron 构建缓存文件，可能非常大
2. **`.pkg` 安装包文件** - macOS 安装包，通常几十到上百 MB
3. **示例图片文件** - `src/imgs/example/` 目录下的截图文件
4. **构建输出文件** - 之前可能误提交了 `dist/`、`build/` 等目录

即使这些文件已经从当前工作目录删除或添加到 `.gitignore`，它们仍然存在于 Git 历史记录中，导致克隆时需要下载完整的历史记录。

## 解决方案

### 方案一：使用项目自带的清理脚本（推荐）

项目提供了 `ninja/okugi.sh` 脚本来清理 Git 历史中的大文件：

```bash
# 运行清理脚本（会清理 .electron-cache 和特定 .pkg 文件）
./ninja/okugi.sh
```

**注意**：此操作会重写 Git 历史，需要强制推送：
```bash
git push origin --force --all
git push origin --force --tags
```

### 方案二：使用 git-filter-repo（更强大的工具）

安装 git-filter-repo：

```bash
# macOS
brew install git-filter-repo

# 或使用 pip
pip install git-filter-repo
```

核心操作：

| 场景                   | 命令                                                         |
| :--------------------- | :----------------------------------------------------------- |
| **删除特定大文件**     | `git filter-repo --path "path/to/large_file" --invert-paths` |
| **按大小删除所有文件** | `git filter-repo --strip-blobs-bigger-than 50M`              |
| **仅保留某个子目录**   | `git filter-repo --subdirectory-filter "folder_name/"`       |
| **替换敏感字符串**     | `git filter-repo --replace-text expressions.txt`             |
| **强制执行(非新克隆)** | 以上命令后加 `--force`                                       |

使用 Token 强制推送 (Force Push)

由于 GitHub 不支持密码，需使用 Personal Access Token (PAT) 登录：

```
密码处粘贴 ghp_xxxxxxxx 格式的 Token。
```

### 方案三：重新初始化（最彻底，但会丢失历史）

如果不需要保留 Git 历史记录，可以完全重新初始化：

1. 删除原有的 .git 文件夹
2. 重新运行 `git init`
3. 重新 `git add .` 并 `git commit`
4. 创建新的远程仓库并推送

**注意**：此方法会丢失所有提交历史，请谨慎使用。

## 预防措施

确保以下文件/目录已在 `.gitignore` 中：

- `node_modules/`
- `.electron-cache/`
- `dist/`、`build/`、`out/`
- `*.pkg`、`*.dmg`
- 大型图片和资源文件（除非确实需要版本控制）
