## 免責事項

本ツールを使用してNTFSデバイスをマウントおよび変更することは、データ損失のリスクがあります。使用前に重要なデータをバックアップすることをお勧めします。本ツールは「現状のまま」提供され、明示的または黙示的な保証は一切ありません。本ツールの使用によって生じたデータ損失について、開発者は責任を負いません。

> [!WARN]
> このソフトウェアの安定動作とデータの整合性は、ストレージデバイスの性能に依存します。データの読み書きエラー、転送中断、またはデバイス認識失敗などの問題を避けるため、高品質なフラッシュメモリチップで製造され、信頼性のある読み書き性能を備えたUSBドライブの使用を推奨します。

## システム要件

本ツールを使用するには、以下のシステム依存関係が必要です：

1. **Xcode Command Line Tools** - Appleの開発ツール
2. **Homebrew** - macOSのパッケージマネージャー
3. **MacFUSE** - ファイルシステムユーザー空間フレームワーク
4. **ntfs-3g** - NTFSファイルシステムドライバー

### システム依存関係のインストール

初回使用前に、システム依存関係がインストールされているか確認してください。「システム依存」タブで「依存関係を確認」ボタンをクリックすると、システムが必要な依存関係のインストール状態を自動的に検出します。

不足している依存関係が検出された場合は、以下の手順に従って手動でインストールしてください：

#### 1. Xcode Command Line Toolsのインストール

ターミナルで以下のコマンドを実行します：

```bash
xcode-select --install
```

実行するとインストールウィンドウが表示されます。プロンプトに従ってインストールを完了してください。インストールプロセスには数分から数十分かかる場合がありますので、お待ちください。

#### 2. Homebrewのインストール

ターミナルで以下のコマンドを実行します：

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

プロンプトに従ってインストールを完了してください。ネットワークが遅い場合は、国内ミラーソースを使用できます：

```bash
/bin/bash -c "$(curl -fsSL https://gitee.com/ineo6/homebrew-install/raw/master/install.sh)"
```

#### 3. MacFUSEのインストール

ターミナルで以下のコマンドを実行します：

```bash
brew install --cask macfuse
```

#### 4. ntfs-3gのインストール

ターミナルで以下のコマンドを実行します：

```bash
brew tap gromgit/homebrew-fuse
brew install ntfs-3g-mac
```

**注意**：インストール順序が重要です。1 → 2 → 3 → 4 の順序でインストールしてください。

## インターフェースアイコンの説明

アプリケーションのメインインターフェースには、よく使う機能にすばやくアクセスできるよう、いくつかの機能アイコンが用意されています：

### タイトルバーアイコン

- <img src="../imgs/svg/devices/flash-auto.svg" alt="自動読み書き" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **自動読み書きアイコン** - 有効にすると、新しく挿入された NTFS デバイスが自動的に読み書きモードでマウントされます。アイコンがアクティブなときは青色で表示されます。
- <img src="../imgs/svg/devices/tray.svg" alt="トレイモード" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **トレイモードアイコン** - 有効にすると、ウィンドウを閉じたときにアプリケーションが終了せず、システムトレイに最小化されます。アイコンがアクティブなときは赤色で表示されます。
- <img src="../imgs/svg/system/caffe.svg" alt="スリープ防止" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **スリープ防止アイコン** - 有効にすると、システムがスリープモードに入ることを防ぎ、デバイスが継続的に利用可能であることを保証します。アイコンがアクティブなときはコーヒー色で表示されます。
- <img src="../imgs/svg/system/protect.svg" alt="状態保護" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **状態保護アイコン** - 3s長押しで保護状態を切り替えます。保護後、自動読み書き、トレイモード、スリープ防止機能が無効になり、誤操作を防ぎます。アイコンが保護されると緑色でパルスアニメーションが表示されます。
- <img src="../imgs/svg/ui/info.svg" alt="情報" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **情報アイコン** - 情報ウィンドウを開き、アプリケーション情報とプロジェクトリンクを表示します。
- <img src="../imgs/svg/actions/exit.svg" alt="終了" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **終了アイコン** - アプリケーションを終了します。

### タブアイコン

- <img src="../imgs/svg/ui/log.svg" alt="ログ" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **ログアイコン** - 「操作ログ」タブに切り替えて、すべての操作の記録を表示します。

### デバイス管理アイコン

- <img src="../imgs/svg/actions/refresh.svg" alt="更新" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;"> **更新アイコン** - デバイスリストを更新し、接続されている NTFS デバイスを再検出します。

## 使用手順

### システム依存関係の確認

「システム依存」タブで「依存関係を確認」ボタンをクリックすると、システムが必要な依存関係のインストール状態を自動的に検出します。不足している依存関係が検出された場合、インストールコマンドと説明を含む詳細なインストールガイドが表示されます。

### NTFSデバイスの管理

NTFS形式の移動ストレージデバイスを挿入すると、「NTFSデバイス」タブで接続されているすべてのデバイスを確認できます。

#### ダブルクリックでドライブを開く（Finder）

**「NTFSデバイス」タブ** または **トレイメニュー** で、まず**対象のデバイス項目を選択**し、次に**そのデバイスをダブルクリック**すると、Finder で対応するマウント先ディレクトリを直接開けます。

デバイスの状態は2種類あります：

- **読み取り専用** - デバイスは読み取りのみ可能で、書き込みはできません。これはmacOSがNTFSデバイスを処理するデフォルトの方法です。
- **読み書き可能** - デバイスは読み書きモードでマウントされており、ファイルを正常に読み書きできます。

**容量バーガイド：**

メインインターフェースとトレイメニューでは、各デバイスに容量バーが表示され、ストレージスペースの使用状況を視覚的に表示します。色の意味は以下の通りです：

- **青色**（0-74%）：スペースが十分で、残りスペースが25%以上あります
- **黄色**（75-89%）：スペースが不足しており、残りスペースが11%-25%です。ファイルを早めに整理することをお勧めします
- **赤色**（90-100%）：スペースが深刻に不足しており、残りスペースが10%未満です。スペースを確保するために、すぐにファイルを整理する必要があります

### 自動読み書き機能

自動読み書き機能により、手動操作なしで新しく挿入されたNTFSデバイスを自動的に読み書きモードでマウントできます。

**有効にする方法：**

- タイトルバーで自動読み書きアイコン（<img src="../imgs/svg/devices/flash-auto.svg" alt="自動読み書き" style="height: 14px; width: 14px; vertical-align: middle; margin-right: 4px; display: inline-block;">）をクリックします。アイコンが青色になると有効になります
- トレイメニューで「自動読み書き」オプションにチェックを入れます
- メインインターフェースのタイトルバーの自動読み書きボタンで切り替えます

**機能の特徴：**

- **新規デバイスの自動検出**：新しいNTFSデバイスを挿入すると、アプリが自動的に検出し、読み書きモードでマウントします
- **手動読み取り専用デバイスのスマートスキップ**：デバイスを手動で読み取り専用に設定した場合、自動読み書き機能はその選択を尊重し、再度読み書きモードでマウントしません
- **有効化時の既存デバイスの自動処理**：自動読み書き機能を有効にすると、アプリは現在接続されている読み取り専用デバイス（手動で読み取り専用に設定したデバイスを除く）を自動的にチェックし、読み書きモードでマウントを試みます

**使用シナリオ：**

- 複数のNTFSデバイスを頻繁に使用し、毎回手動操作なしで自動マウントしたい場合
- 複数のデバイスを一括処理する必要がある場合、一度自動読み書き機能を有効にできます
- 一時的に自動マウント機能が必要な場合、いつでもオン/オフできます

**注意事項：**

- 自動読み書き機能には管理者権限が必要です。最初のマウント時にパスワードの入力が求められます
- デバイスを手動で読み取り専用に設定した場合、そのデバイスは「手動読み取り専用デバイス」リストに追加され、自動読み書き機能は再度マウントしません
- デバイスを手動で読み書きモードでマウントした場合、そのデバイスは「手動読み取り専用デバイス」リストから削除され、その後自動読み書き機能を正常に使用できます
- 自動読み書き機能は手動操作に影響しません。いつでも手動でデバイスをマウントまたはアンマウントできます

**状態リセットメカニズム：**

自動読み書き機能の知能性とユーザー体験を確保するため、アプリケーションは以下の状態リセットメカニズムを実装しています：

- **クールダウン保護**：デバイスを手動で読み取り専用に設定するか、リセット操作を実行すると、システムは8秒のクールダウン期間を設定します。この期間中、自動読み書き機能はトリガーされず、設定したばかりの状態がすぐに上書きされることを防ぎます
- **デバイス取り外しリセット**：デバイスが取り外された後、8-9秒以内に再挿入された場合、手動読み取り専用状態は保持されます。9秒を超えて再挿入された場合、デバイスは自動的に「手動読み取り専用デバイス」リストから削除され、デフォルトの動作に戻り、自動読み書き機能を正常に使用できます
- **スマートクリーンアップ**：システムは取り外されたデバイスのクールダウン記録と手動読み取り専用状態を自動的にクリーンアップし、デバイスが再挿入されたときに正常に動作することを保証します

### デバイスを読み書きモードでマウント

読み取り専用状態のデバイスは、「読み書き」ボタンをクリックして読み書きモードでマウントできます。この操作には管理者権限が必要で、システムがパスワード入力ダイアログを表示します。

**注意事項：**

- マウント操作には管理者権限が必要です。システムパスワードを準備してください
- マウントが失敗した場合、考えられる原因は次のとおりです：
  - デバイスのファイルシステムがダーティ状態（このNTFSデバイスが以前にWindowsコンピューターで使用され、Windowsで高速スタートアップ機能が有効になっていた場合、デバイスをWindowsコンピューターに再度接続して完全にシャットダウンしてから再試行してください）
  - デバイスが他のプログラムによって使用されている
  - システム権限の問題
- マウント後は、データ損失を避けるためにデバイスを安全に取り出してください

### デバイスのアンマウント

マウントされたデバイスは、「アンマウント」ボタンをクリックしてアンマウントできます。アンマウント操作には管理者権限が必要です。

**アンマウントの特徴：**
- ファイルシステムからデバイスを削除
- デバイスは物理的にコンピューターに接続されたまま
- システムがデバイスを自動的に再マウントする場合があります（例：再挿入やシステムの自動マウント）
- デバイスはリストに残り、「アンマウント済み」状態としてマークされます
- 再マウントして使用できます

**適用シナリオ：**
- デバイスがコンピューターに接続されたまま、一時的にデバイスアクセスを切断
- デバイスのマウント方法を再設定する必要がある場合
- デバイスに問題が発生した場合、先にアンマウントしてから再マウント

### デバイスのイジェクト

マウントされたデバイスは、「イジェクト」ボタンをクリックして完全に切断できます。イジェクト操作には管理者権限は不要です。

**イジェクトの特徴：**
- デバイスを完全に切断し、システムから削除
- デバイスはリストから消えます
- システムはデバイスを自動的に再マウントしません
- デバイスを再挿入する必要があります
- デバイスを安全に取り出せることを示します

**適用シナリオ：**
- デバイスを取り出す前に、データが完全に書き込まれたことを確認
- デバイス接続を完全に切断する必要がある場合
- デバイスが不要になった場合
- macOS Finderの「イジェクト」機能と同様

**アンマウント vs イジェクト：**

| 特徴 | アンマウント | イジェクト |
|------|------------|-----------|
| 管理者権限が必要 | ✅ はい | ❌ いいえ |
| デバイスの物理接続 | ✅ 接続を維持 | ✅ 接続を維持 |
| システムの自動再マウント | ⚠️ 可能性あり | ❌ なし |
| リスト内のデバイス | ✅ 保持（アンマウント済みとしてマーク） | ❌ 削除 |
| 再マウント可能 | ✅ 可能 | ❌ 再挿入が必要 |
| 適用シナリオ | 一時的な切断、再設定 | 取り出し準備、完全切断 |

## よくある質問

### デバイスが読み取り専用と表示されるのはなぜですか？

これはmacOSのデフォルトの動作です。macOSはデフォルトでNTFSデバイスを読み取り専用モードでマウントします。本ツールを使用すると、デバイスを読み書きモードでマウントできます。

### マウントが失敗した場合はどうすればよいですか？

マウント操作が失敗またはタイムアウトした場合、以下を確認してください：

- **システム依存関係**：すべてのシステム依存関係がインストールされていることを確認（Xcode Command Line Tools、Homebrew、MacFUSE、ntfs-3g）
- **管理者権限**：入力した管理者パスワードが正しいことを確認
- **ファイルシステムの状態**：このNTFSデバイスが以前にWindowsコンピューターで使用され、Windowsで高速スタートアップ機能が有効になっていた場合、ファイルシステムがダーティ状態になっている可能性があります。デバイスをWindowsコンピューターに再度接続して完全にシャットダウン（スリープ/休止状態ではなく）してから、再度マウントを試してください
- **デバイスの使用状況**：他のプログラムがデバイスを使用していないか確認し、関連するプログラムを閉じてから再試行してください
- **操作タイムアウト**：操作がタイムアウトした場合、アプリケーションは自動的に操作をキャンセルしてハングを防ぎます。上記の原因を確認してから再試行してください

#### "Resource busy" エラー

`Error opening '/dev/diskXsX': Resource busy` エラーが発生した場合、通常は操作が強制的に中断されたことにより、デバイスがまだ占有されている状態です。解決方法：

1. **デバイスパスの確認**：`diskutil list` コマンドを使用して、対応するディスクデバイス（例：`/dev/disk5s1`）を確認します

2. **デバイスのアンマウント**：
   ```bash
   sudo diskutil unmount /dev/disk5s1
   ```
   注意：`/dev/disk5s1` を実際のデバイスパスに置き換えてください

3. **ファイルシステムの修復**：アンマウント状態で修復を完了します
   ```bash
   sudo ntfsfix /dev/disk5s1
   ```

4. **再マウント**：修復が完了したら、デバイスのマウントを再度試してください

**原因**：このエラーは、マウント操作が強制的に中断された場合（アプリケーションの強制終了、システムクラッシュなど）に、デバイスがまだ占有状態のままになっているときに発生します。再マウントする前に、アンマウントして修復する必要があります。

**リセットボタンの使用**："Resource busy" エラーが発生した場合、デバイスリストの「リセット」ボタンを直接クリックすることもできます。リセット機能は以下の操作を自動的に実行します：
- デバイスのアンマウント
- ファイルシステムの修復
- デバイス占有状態のクリア

リセット操作には管理者権限が必要で、デバイス占有の問題を迅速に解決するのに適しています。

### 依存関係のインストールが失敗した場合はどうすればよいですか？

インストール中に問題が発生した場合は、以下を確認してください：

- **ネットワーク接続**：ネットワーク接続が正常であることを確認。インストールにはファイルのダウンロードが必要です
- **ディスク容量**：十分なディスク容量があることを確認（Xcode Command Line Toolsには数GBの容量が必要です）
- **システム権限**：管理者権限があることを確認。一部のインストールにはパスワード入力が必要です
- **インストール順序**：正しい順序で依存関係をインストールしてください（Xcode → Homebrew → MacFUSE → ntfs-3g）

**よくある問題：**

1. **Xcode Command Line Toolsのインストールが失敗**
   - ネットワーク接続を確認
   - Apple Developer Webサイトから手動でインストーラーをダウンロードしてみてください

2. **Homebrewのインストールが遅い、または失敗**
   - 国内ミラーソースを使用（上記のインストール手順を参照）
   - ネットワークプロキシ設定を確認

3. **MacFUSEまたはntfs-3gのインストールが失敗**
   - 先にHomebrewがインストールされていることを確認
   - `brew update`を実行してHomebrewを更新
   - 権限の問題がないか確認

問題が解決しない場合は、各依存関係の公式ドキュメントを参照するか、技術サポートに問い合わせてください。

### アンマウント後にデバイスにアクセスできない場合はどうすればよいですか？

アンマウント後、デバイスはシステムから削除されます。再度アクセスする必要がある場合は、デバイスを再挿入するか、システムの組み込みマウント機能を使用してください。

## 操作ログ

「操作ログ」タブでは、すべての操作の記録を確認できます。これには以下が含まれます：

- 依存関係チェック結果
- デバイス検出状態
- マウント/アンマウント操作結果
- エラーメッセージと警告

**操作ログを有効化：**

操作ログはデフォルトで無効になっており、手動で有効にする必要があります。「操作ログ」タブで「操作ログを有効化」チェックボックスをチェックすると有効になります。有効にすると、アプリはすべての操作ログを記録します。無効にすると、新しいログは記録されませんが、既に記録されたログは保持されます。

**ログの保存：**

ログは JSON 形式でファイルシステムに保存され、保存場所は次のとおりです：

```
~/Library/Application Support/Nigate/logs.json
```

ログファイルはフォーマットされた JSON 形式で、テキストエディタで直接開いて確認できます。アプリをアンインストールしても、ログファイルは自動的に削除されないため、後で確認やバックアップが容易です。

**ログの制限：**

アプリケーションのパフォーマンスと安定性を確保するため、ログシステムには以下の制限があります：

- **保持期間**：ログはデフォルトで最大30日間保存されます。30日を超えたログは自動的にクリーンアップされます
- **記録数制限**：最大500件のログエントリが保持されます。制限を超えると、最も古いエントリが自動的に削除され、最新の500件のみが保持されます
- **ファイルサイズ制限**：ログファイルの最大サイズは 500KB です。制限を超えると、ファイルサイズを制限内に保つため、古いエントリが自動的に削除されます
- **表示数制限**：インターフェースには最大300件のログエントリ（最新の300件）が表示され、レンダリングパフォーマンスを向上させます

**ログ管理：**

- **ログをクリア**：「クリア」ボタンをクリックすると、すべてのログ記録をクリアできます
- **ログをエクスポート**：「エクスポート」ボタンをクリックすると、ログをテキストファイルとしてエクスポートでき、バックアップや共有に便利です

## その他のトラブルシューティング

他の問題（「ファイルが破損しています」という警告、デバイス busy エラー、ドライバーの競合など）が発生した場合は、[トラブルシューティングセンター](https://github.com/hoochanlon/Free-NTFS-for-Mac/issues/9) を参照してください。詳細なトラブルシューティング手順と解決策が含まれています。
