## 免責事項

本ツールを使用してNTFSデバイスをマウントおよび変更することは、データ損失のリスクがあります。使用前に重要なデータをバックアップすることをお勧めします。本ツールは「現状のまま」提供され、明示的または黙示的な保証は一切ありません。本ツールの使用によって生じたデータ損失について、開発者は責任を負いません。

## システム要件

本ツールを使用するには、以下のシステム依存関係が必要です：

1. **Swift (Xcode Command Line Tools)** - Appleの開発ツール
2. **Homebrew** - macOSのパッケージマネージャー
3. **MacFUSE** - ファイルシステムユーザー空間フレームワーク
4. **ntfs-3g** - NTFSファイルシステムドライバー

### システム依存関係のインストール

初回使用前に、システム依存関係がインストールされているか確認してください。「システム依存」タブで「依存関係を確認」ボタンをクリックすると、システムが必要な依存関係のインストール状態を自動的に検出します。

不足している依存関係が検出された場合は、以下の手順に従って手動でインストールしてください：

#### 1. Xcode Command Line Toolsのインストール

ターミナルで以下のコマンドを実行します：

```bash
xcode-select --install
```

実行するとインストールウィンドウが表示されます。プロンプトに従ってインストールを完了してください。インストールプロセスには数分から数十分かかる場合がありますので、お待ちください。

#### 2. Homebrewのインストール

ターミナルで以下のコマンドを実行します：

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

プロンプトに従ってインストールを完了してください。ネットワークが遅い場合は、国内ミラーソースを使用できます：

```bash
/bin/bash -c "$(curl -fsSL https://gitee.com/ineo6/homebrew-install/raw/master/install.sh)"
```

#### 3. MacFUSEのインストール

ターミナルで以下のコマンドを実行します：

```bash
brew install --cask macfuse
```

#### 4. ntfs-3gのインストール

ターミナルで以下のコマンドを実行します：

```bash
brew tap gromgit/homebrew-fuse
brew install ntfs-3g-mac
```

**注意**：インストール順序が重要です。1 → 2 → 3 → 4 の順序でインストールしてください。

## 使用手順

### システム依存関係の確認

「システム依存」タブで「依存関係を確認」ボタンをクリックすると、システムが必要な依存関係のインストール状態を自動的に検出します。不足している依存関係が検出された場合、インストールコマンドと説明を含む詳細なインストールガイドが表示されます。

### NTFSデバイスの管理

NTFS形式の移動ストレージデバイスを挿入すると、「NTFSデバイス」タブで接続されているすべてのデバイスを確認できます。

デバイスの状態は2種類あります：

- **読み取り専用** - デバイスは読み取りのみ可能で、書き込みはできません。これはmacOSがNTFSデバイスを処理するデフォルトの方法です。
- **読み書き可能** - デバイスは読み書きモードでマウントされており、ファイルを正常に読み書きできます。

### デバイスを読み書きモードでマウント

読み取り専用状態のデバイスは、「読み書き可能に設定」ボタンをクリックして読み書きモードでマウントできます。この操作には管理者権限が必要で、システムがパスワード入力ダイアログを表示します。

**注意事項：**

- マウント操作には管理者権限が必要です。システムパスワードを準備してください
- マウントが失敗した場合、考えられる原因は次のとおりです：
  - デバイスのファイルシステムがダーティ状態（このNTFSデバイスが以前にWindowsコンピューターで使用され、Windowsで高速スタートアップ機能が有効になっていた場合、デバイスをWindowsコンピューターに再度接続して完全にシャットダウンしてから再試行してください）
  - デバイスが他のプログラムによって使用されている
  - システム権限の問題
- マウント後は、データ損失を避けるためにデバイスを安全に取り出してください

### デバイスのアンマウント

マウントされたデバイスは、「アンマウント」ボタンをクリックしてアンマウントできます。アンマウント操作には管理者権限が必要です。

**アンマウントの特徴：**
- ファイルシステムからデバイスを削除
- デバイスは物理的にコンピューターに接続されたまま
- システムがデバイスを自動的に再マウントする場合があります（例：再挿入やシステムの自動マウント）
- デバイスはリストに残り、「アンマウント済み」状態としてマークされます
- 再マウントして使用できます

**適用シナリオ：**
- デバイスがコンピューターに接続されたまま、一時的にデバイスアクセスを切断
- デバイスのマウント方法を再設定する必要がある場合
- デバイスに問題が発生した場合、先にアンマウントしてから再マウント

### デバイスのイジェクト

マウントされたデバイスは、「イジェクト」ボタンをクリックして完全に切断できます。イジェクト操作には管理者権限は不要です。

**イジェクトの特徴：**
- デバイスを完全に切断し、システムから削除
- デバイスはリストから消えます
- システムはデバイスを自動的に再マウントしません
- デバイスを再挿入する必要があります
- デバイスを安全に取り出せることを示します

**適用シナリオ：**
- デバイスを取り出す前に、データが完全に書き込まれたことを確認
- デバイス接続を完全に切断する必要がある場合
- デバイスが不要になった場合
- macOS Finderの「イジェクト」機能と同様

**アンマウント vs イジェクト：**

| 特徴 | アンマウント | イジェクト |
|------|------------|-----------|
| 管理者権限が必要 | ✅ はい | ❌ いいえ |
| デバイスの物理接続 | ✅ 接続を維持 | ✅ 接続を維持 |
| システムの自動再マウント | ⚠️ 可能性あり | ❌ なし |
| リスト内のデバイス | ✅ 保持（アンマウント済みとしてマーク） | ❌ 削除 |
| 再マウント可能 | ✅ 可能 | ❌ 再挿入が必要 |
| 適用シナリオ | 一時的な切断、再設定 | 取り出し準備、完全切断 |

## よくある質問

### デバイスが読み取り専用と表示されるのはなぜですか？

これはmacOSのデフォルトの動作です。macOSはデフォルトでNTFSデバイスを読み取り専用モードでマウントします。本ツールを使用すると、デバイスを読み書きモードでマウントできます。

### マウントが失敗した場合はどうすればよいですか？

マウント操作が失敗またはタイムアウトした場合、以下を確認してください：

- **システム依存関係**：すべてのシステム依存関係がインストールされていることを確認（Xcode Command Line Tools、Homebrew、MacFUSE、ntfs-3g）
- **管理者権限**：入力した管理者パスワードが正しいことを確認
- **ファイルシステムの状態**：このNTFSデバイスが以前にWindowsコンピューターで使用され、Windowsで高速スタートアップ機能が有効になっていた場合、ファイルシステムがダーティ状態になっている可能性があります。デバイスをWindowsコンピューターに再度接続して完全にシャットダウン（スリープ/休止状態ではなく）してから、再度マウントを試してください
- **デバイスの使用状況**：他のプログラムがデバイスを使用していないか確認し、関連するプログラムを閉じてから再試行してください
- **操作タイムアウト**：操作がタイムアウトした場合、アプリケーションは自動的に操作をキャンセルしてハングを防ぎます。上記の原因を確認してから再試行してください

### 依存関係のインストールが失敗した場合はどうすればよいですか？

インストール中に問題が発生した場合は、以下を確認してください：

- **ネットワーク接続**：ネットワーク接続が正常であることを確認。インストールにはファイルのダウンロードが必要です
- **ディスク容量**：十分なディスク容量があることを確認（Xcode Command Line Toolsには数GBの容量が必要です）
- **システム権限**：管理者権限があることを確認。一部のインストールにはパスワード入力が必要です
- **インストール順序**：正しい順序で依存関係をインストールしてください（Xcode → Homebrew → MacFUSE → ntfs-3g）

**よくある問題：**

1. **Xcode Command Line Toolsのインストールが失敗**
   - ネットワーク接続を確認
   - Apple Developer Webサイトから手動でインストーラーをダウンロードしてみてください

2. **Homebrewのインストールが遅い、または失敗**
   - 国内ミラーソースを使用（上記のインストール手順を参照）
   - ネットワークプロキシ設定を確認

3. **MacFUSEまたはntfs-3gのインストールが失敗**
   - 先にHomebrewがインストールされていることを確認
   - `brew update`を実行してHomebrewを更新
   - 権限の問題がないか確認

問題が解決しない場合は、各依存関係の公式ドキュメントを参照するか、技術サポートに問い合わせてください。

### アンマウント後にデバイスにアクセスできない場合はどうすればよいですか？

アンマウント後、デバイスはシステムから削除されます。再度アクセスする必要がある場合は、デバイスを再挿入するか、システムの組み込みマウント機能を使用してください。

## 操作ログ

「操作ログ」タブでは、すべての操作の記録を確認できます。これには以下が含まれます：

- 依存関係チェック結果
- デバイス検出状態
- マウント/アンマウント操作結果
- エラーメッセージと警告

**操作ログを有効化：**

操作ログはデフォルトで無効になっており、手動で有効にする必要があります。「操作ログ」タブで「操作ログを有効化」チェックボックスをチェックすると有効になります。有効にすると、アプリはすべての操作ログを記録します。無効にすると、新しいログは記録されませんが、既に記録されたログは保持されます。

**ログの保存：**

ログは JSON 形式でファイルシステムに保存され、保存場所は次のとおりです：

```
~/Library/Application Support/Nigate/logs.json
```

ログファイルはフォーマットされた JSON 形式で、テキストエディタで直接開いて確認できます。アプリをアンインストールしても、ログファイルは自動的に削除されないため、後で確認やバックアップが容易です。

**ログの制限：**

アプリケーションのパフォーマンスと安定性を確保するため、ログシステムには以下の制限があります：

- **保持期間**：ログはデフォルトで最大30日間保存されます。30日を超えたログは自動的にクリーンアップされます
- **記録数制限**：最大500件のログエントリが保持されます。制限を超えると、最も古いエントリが自動的に削除され、最新の500件のみが保持されます
- **ファイルサイズ制限**：ログファイルの最大サイズは 500KB です。制限を超えると、ファイルサイズを制限内に保つため、古いエントリが自動的に削除されます
- **表示数制限**：インターフェースには最大300件のログエントリ（最新の300件）が表示され、レンダリングパフォーマンスを向上させます

**ログ管理：**

- **ログをクリア**：「クリア」ボタンをクリックすると、すべてのログ記録をクリアできます
- **ログをエクスポート**：「エクスポート」ボタンをクリックすると、ログをテキストファイルとしてエクスポートでき、バックアップや共有に便利です

## その他のトラブルシューティング

他の問題（「ファイルが破損しています」という警告、デバイス busy エラー、ドライバーの競合など）が発生した場合は、[トラブルシューティングセンター](https://github.com/hoochanlon/Free-NTFS-for-Mac/issues/9) を参照してください。詳細なトラブルシューティング手順と解決策が含まれています。
